#!/bin/bash -e

# Install gems
bundle install --jobs=4 --path=/bundle

# Wait for MySQL staring
until mysqladmin ping -h${MYSQL_HOSTNAME} -u${MYSQL_ROOT_USER} -p${MYSQL_ROOT_PASSWORD} --silent; do
  sleep 1
done

# Remove process file
if [ -e /app/tmp/pids/*.pid ]; then rm /app/tmp/pids/*.pid; fi

# Setup database
bundle exec rails db:migrate 2>/dev/null || bundle exec rails db:setup

# Execute the given or default command
exec "$@"
